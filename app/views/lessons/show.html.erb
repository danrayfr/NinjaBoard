<%= content_for(:title, "#{@course.title} | #{@lesson.title}") %>

<section class="py-12 lg:py-28 bg-gray-100">
  <div class="container mx-auto px-4 xl:px-0">

  <div>
    <% if notice.present? %>
      <div class="p-4 text-sm text-gray-800 rounded-lg bg-gray-50 dark:bg-gray-800 dark:text-gray-300" role="alert"><%= notice %></div>
    <% end %>
  </div>

  <div class="text-center space-y-4">
    <h1 class="max-w-lg mx-auto text-2xl lg:text-5xl font-black text-slate-800">
      <%= @course.title %>
    </h1>
    <p class="max-w-xl mx-auto text-sm font-normal text-slate-500">
    <%= time_tag(@course.created_at, "data-local": "time-ago") %></p>

    <!-- Breadcrumbs -->
    <div class="flex items-center justify-center gap-4">
      <ul class="flex px-5 py-3 text-gray-700 border border-gray-200 rounded-lg bg-gray-50">
        <li class="leading-none text-dark">
          <%= link_to root_path, class: "inline-flex items-center text-orange-700" do %>
            <svg class="mr-2" width="15" height="15" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M13.1769 15.0588H10.3533V9.41178H5.64744V15.0588H2.82391V6.58825H1.88274V16H14.118V6.58825H13.1769V15.0588ZM6.58862 15.0588V10.353H9.41215V15.0588H6.58862ZM15.8084 6.09225L15.2512 6.85178L8.00038 1.52472L0.749559 6.8499L0.192383 6.09131L8.00038 0.357666L15.8084 6.09225Z"
                fill="black"
              ></path>
            </svg>
            <span class="text-sm leading-none">Home</span>
          <% end %>
        </li>
        <li class="leading-none text-dark">
          <%= link_to "/ Course", course_path(@course), class: "text-sm leading-none" %>
        </li>
        <li class="leading-none text-dark">
          <span class="text-sm leading-none">/ <%= pluralize @course.lessons.count, "lesson" %></span>
        </li>
      </ul>
    </div>
  
  <div class="flex flex-col lg:flex-row-reverse w-full justify-start lg:justify-end pb-6">
    <div class="w-full">
      
      <div data-controller="watcher" data-watcher-lesson-id-value="<%= @lesson.id %>" data-watcher-course-id-value="<%= @course.id %>" data-video-required-watch-duration-value="300" class="flex flex-grow items-center p-12 <%= @completed_lessons.include?(@lesson.id) ? '' : 'lesson-not-completed' %>">
        <% if @lesson.video.present? %>
            <%= video_tag @lesson.video, autoplay: false, class: "w-full rounded", data: { watcher_target: "video" }, controls: true, controlsList: "nodownload", disablePictureInPicture: true %>
        <% else %>
          <div class="grid grid-cols-3 gap-4 content-center">
            <div class="w-20 h-20 mx-auto bg-gray-50 rounded-full shadow-sm justify-center items-center inline-flex">
              <%= icon "fa-solid", "video-slash" %>
            </div>
            <div>
            <h2 class="text-center text-black text-base font-semibold leading-relaxed pb-1">There is no video attachment available.</h2>
            </div>
          </div>
        <% end %>
      </div>

      <div class="text-left space-y-4">
        <h1 class="text-2xl font-bold capitalize"><%= @lesson.title %></h1>
        <ul>
          <li class="gap-x-2"><span class="font-medium text-blue-950" aria-hidden="true">Watch duration:</span><span class="font-display text-slate-600" aria-hidden="true"> <%= lesson_watch_duration(@lesson) %></span></li>
        </ul>
        <p class="text-gray-950 text-lg"><%= @lesson.description %></p>
        
      </div>

      <div class="my-6 lg:mb-0">
        <%= link_to "Mark as complete", course_lesson_path(@course, @lesson), data: { "turbo_method" => :put }, class: "bg-green-500 rounded hover:bg-green-600 text-white-50 px-4 py-2" unless @lesson.video.present? %>
      </div>
    </div>

    <div class="lg:min-w-60 lg:mr-4 lg:overflow-y-scroll">
      <%= render "sidebar", course: @course, completed_lessons: @completed_lessons, paid_for_course: @paid_for_course %>
    </div>

  </div>  
</div>
</section>
